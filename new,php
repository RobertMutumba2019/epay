<?php
// admin_dashboard.php
require_once 'login.php'; // Checks if user is authenticated
require_once 'ApprovalMatrix.php';

$db = getDBConnection(); // Your DB connection function
$approvalMatrix = new ApprovalMatrix($db, $_SESSION['user_id'], $_SESSION['role']);

try {
    $matrices = $approvalMatrix->getAll();
} catch (Exception $e) {
    die($e->getMessage());
}
?>

<h1>Approval Matrices</h1>
<table>
    <thead>
        <tr>
            <th>Code</th>
            <th>Unit Code</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($matrices as $matrix): ?>
        <tr>
            <td><?= htmlspecialchars($matrix['code']) ?></td>
            <td><?= htmlspecialchars($matrix['unit_code']) ?></td>
            <td>
                <?php if ($approvalMatrix->hasPermission('approval_matrix', 'update')): ?>
                <a href="edit_matrix.php?id=<?= $matrix['id'] ?>">Edit</a>
                <?php endif; ?>
                
                <?php if ($approvalMatrix->hasPermission('approval_matrix', 'delete')): ?>
                <a href="delete_matrix.php?id=<?= $matrix['id'] ?>" onclick="return confirm('Are you sure?')">Delete</a>
                <?php endif; ?>
            </td>
        </tr>
        <?php endforeach; ?>
    </tbody>
</table>